<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Rodízio de Cultos — Gerador Automático</title>
<style>
  :root{
    --border:#7a7a7a;
    --header-bg:#6f6f6f;
    --sheet-bg:#f3f3f3;
    --blue:#dbe7ff;
    --orange:#f4e0c8;
    --red:#f8d6d6;
    --titlebar:#cfcfcf;
  }
  *{box-sizing:border-box}
  body{
    font-family: Arial, Helvetica, sans-serif;
    margin:0; background:#f7f7f7; color:#111;
  }
  .wrap{max-width:1100px;margin:18px auto;padding:16px;background:#fff;box-shadow:0 2px 10px rgba(0,0,0,.06)}
  h1{font-size:28px;margin:0 0 6px;text-align:center}
  .sub{ text-align:center;color:#333;margin-bottom:12px }

  .controls{display:flex;gap:8px;flex-wrap:wrap;align-items:center;justify-content:center;margin-bottom:12px}
  label{font-weight:600;margin-right:6px}
  input[type="month"], select, button{padding:8px;font-size:14px}
  button{cursor:pointer;border:1px solid #888;background:#eee}
  .btn-primary{background:#2e6be6;color:#fff;border-color:#2e6be6}
  .small{font-size:13px}

  .panel{display:flex;gap:16px;flex-wrap:wrap;margin-bottom:12px}
  .card{flex:1 1 360px;padding:12px;border:1px solid var(--border);background: #fff}
  .card h3{margin:0 0 8px;font-size:16px}
  textarea.oper{width:100%;min-height:90px;font-size:14px;padding:8px;border:1px solid #bbb;resize:vertical}
  .op-row{display:flex;gap:8px;align-items:center;margin-bottom:8px}
  .op-row small{color:#666}

  /* tabela estilo planilha */
  .title-bar{display:block;text-align:center;padding:8px;border:1px solid var(--border);background:var(--titlebar);font-weight:700;margin-bottom:8px}
  table.sheet{width:100%;border-collapse:collapse;margin:8px 0 18px;font-size:14px}
  table.sheet th, table.sheet td{border:1px solid var(--border);padding:8px;vertical-align:middle}
  table.sheet th{background:#e6e6e6;font-weight:700;text-align:left}
  .section-title-row th{background:var(--sheet-bg);font-weight:800}
  .sec-blue{background:var(--blue)}
  .sec-orange{background:var(--orange)}
  .sec-red{background:var(--red)}

  /* responsivo */
  @media (max-width:820px){
    .panel{flex-direction:column}
    .card{min-width:unset}
  }

  @media print{
    .controls, .card input, .card button, .card .small{display:none}
    body{background:#fff}
  }

  /* pequenas melhorias visuais */
  .muted{color:#666;font-size:13px}
</style>
</head>
<body>
<div class="wrap">
  <h1>RODÍZIO MÊS DE <span id="previewMes">—</span></h1>
  <div class="sub">Congregação Cristã no Brasil</div>

  <div class="controls">
    <label for="monthPick">Mês:</label>
    <input id="monthPick" type="month" />
    <button id="btnGenerate" class="btn-primary">Gerar Rodízio</button>
    <button id="btnSaveOps">Salvar Operadores</button>
    <button id="btnResetPtrs">Resetar Sequência</button>
    <label class="small" style="margin-left:6px">Opção: </label>
    <select id="optResetOnMonth" title="Se sim, reinicia sequências ao trocar mês">
      <option value="no">Continuar sequência entre meses (recomendado)</option>
      <option value="yes">Reiniciar (começa do 1º da lista a cada mês)</option>
    </select>
  </div>

  <div class="panel">
    <div class="card">
      <h3>Operadores — cada nome em uma linha (use ENTER para nova linha)</h3>

      <div class="op-row">
        <div style="flex:1">
          <label><strong>Culto (Dom / Ter / Qui)</strong></label>
          <textarea id="opsCulto" class="oper" placeholder="ABIMAEL\nDANIEL\nFABIO\nJONATAS"></textarea>
          <div class="muted">Ex.: 1 nome por linha</div>
        </div>
      </div>

      <div class="op-row">
        <div style="flex:1">
          <label><strong>Reunião de Jovens (Dom manhã)</strong></label>
          <textarea id="opsReuniao" class="oper" placeholder="ABIMAEL\nDANIEL\nFABIO\nJONATAS"></textarea>
        </div>
      </div>

      <div class="op-row">
        <div style="flex:1">
          <label><strong>Ensaio (2ª sexta do mês)</strong></label>
          <textarea id="opsEnsaio" class="oper" placeholder="ABIMAEL\nDANIEL\nFABIO\nJONATAS"></textarea>
        </div>
      </div>

      <div class="op-row">
        <div style="flex:1">
          <label><strong>Culto de Jovens (2º sábado)</strong></label>
          <textarea id="opsCultoJovem" class="oper" placeholder="ABIMAEL\nDANIEL\nFABIO\nJONATAS"></textarea>
        </div>
      </div>

    </div>

    <div class="card" style="min-width:300px">
      <h3>Observações / Controles</h3>
      <p class="muted">O sistema salva as listas no seu navegador (localStorage) e lembra a posição (ponteiro) de cada rodízio para continuar no mês seguinte.</p>
      <ul style="margin:8px 0 0 18px">
        <li class="muted">Use "Salvar Operadores" para gravar as listas.</li>
        <li class="muted">"Resetar Sequência" volta os ponteiros para o início.</li>
        <li class="muted">A opção de reiniciar mês faz o gerador iniciar sempre do 1º nome.</li>
      </ul>
    </div>
  </div>

  <!-- Resultado -->
  <div id="resultArea">
    <!-- JS preencherá as tabelas aqui -->
  </div>
</div>

<script>
/* ---------- utilitários ---------- */
const monthShort = ['jan.','fev.','mar.','abr.','mai.','jun.','jul.','ago.','set.','out.','nov.','dez.'];
const dayName = ['domingo','segunda-feira','terça-feira','quarta-feira','quinta-feira','sexta-feira','sábado'];

function daysInMonth(year, mIdx){ return new Date(year, mIdx+1, 0).getDate(); }
function fmtShort(dt){ return dt.getDate() + '-' + monthShort[dt.getMonth()]; }
function nthWeekday(year, monthIdx, weekday, n){
  let count=0;
  for(let d=1; d<=daysInMonth(year, monthIdx); d++){
    const dt = new Date(year, monthIdx, d);
    if(dt.getDay()===weekday){ count++; if(count===n) return dt; }
  }
  return null;
}
function allWeekdays(year, monthIdx, wanted){ const arr=[]; for(let d=1; d<=daysInMonth(year, monthIdx); d++){ const dt=new Date(year, monthIdx,d); if(wanted.includes(dt.getDay())) arr.push(dt); } return arr; }

/* ---------- armazenamento ---------- */
function getSaved(key, fallback=''){ return localStorage.getItem(key) || fallback; }
function setSaved(key,val){ localStorage.setItem(key,val); }
function parseArea(text){ return text.split('\n').map(s=>s.trim()).filter(s=>s.length>0); }

/* ponteiros */
function getPtr(k){ return Number(localStorage.getItem('ptr_'+k) || 0); }
function setPtr(k,v){ localStorage.setItem('ptr_'+k, String(v)); }
function resetPtrs(){ setPtr('culto',0); setPtr('reuniao',0); setPtr('ensaio',0); setPtr('cultoJovem',0); alert('Sequência reiniciada.'); }

/* ---------- criar seção tabela ---------- */
function sectionHTML(title, rows, color){
  let html = `<div class="title-bar" style="background:${color};margin-top:12px">${title}</div>`;
  html += `<table class="sheet" aria-label="${title}">`;
  html += `<tr><th style="width:28%">DIA</th><th style="width:20%">DATA</th><th>IRMÃO</th></tr>`;
  rows.forEach(r => {
    html += `<tr><td>${r.dia}</td><td>${r.data}</td><td>${r.irmao}</td></tr>`;
  });
  html += `</table>`;
  return html;
}

/* ---------- gerador principal ---------- */
function gerarRodizio(){
  const monthVal = document.getElementById('monthPick').value;
  if(!monthVal) return alert('Selecione o mês (campo mês).');
  const [y,m] = monthVal.split('-').map(Number);
  const mi = m - 1;
  document.getElementById('previewMes').textContent = monthShort[mi].toUpperCase() + ' - ' + y;

  // operadores (prioriza textarea atual, se vazio usa salvo ou default)
  const saved = {
    culto: getSaved('ops_culto','ABIMAEL\nDANIEL\nFABIO\nJONATAS'),
    reuniao: getSaved('ops_reuniao','ABIMAEL\nDANIEL\nFABIO\nJONATAS'),
    ensaio: getSaved('ops_ensaio','ABIMAEL\nDANIEL\nFABIO\nJONATAS'),
    cultoJovem: getSaved('ops_culto_jovem','ABIMAEL\nDANIEL\nFABIO\nJONATAS')
  };
  const opsCulto = parseArea(document.getElementById('opsCulto').value || saved.culto);
  const opsReuniao = parseArea(document.getElementById('opsReuniao').value || saved.reuniao);
  const opsEnsaio = parseArea(document.getElementById('opsEnsaio').value || saved.ensaio);
  const opsCultoJov = parseArea(document.getElementById('opsCultoJovem').value || saved.cultoJovem);

  // ponteiros
  const resetOnMonth = (document.getElementById('optResetOnMonth').value === 'yes');
  let pCulto = resetOnMonth ? 0 : getPtr('culto');
  let pReuniao = resetOnMonth ? 0 : getPtr('reuniao');
  let pEnsaio = resetOnMonth ? 0 : getPtr('ensaio');
  let pCultoJov = resetOnMonth ? 0 : getPtr('cultoJovem');

  // CULTO: dom, ter, qui (0,2,4)
  const listCultoDates = allWeekdays(y, mi, [0,2,4]);
  const cultoRows = listCultoDates.map(dt => {
    const r = { dia: dayName[dt.getDay()], data: fmtShort(dt), irmao: opsCulto[pCulto % Math.max(1,opsCulto.length)] || '—' };
    pCulto++; return r;
  });

  // REUNIÃO DE JOVENS: todos domingos
  const doms = allWeekdays(y, mi, [0]);
  const reuniaoRows = doms.map(dt => {
    const r = { dia: dayName[dt.getDay()], data: fmtShort(dt), irmao: opsReuniao[pReuniao % Math.max(1,opsReuniao.length)] || '—' };
    pReuniao++; return r;
  });

  // ENSAIO: 2ª sexta-feira do mês (sexta = 5)
  const dt2sexta = nthWeekday(y, mi, 5, 2);
  const ensaioRows = [];
  if(dt2sexta){
    ensaioRows.push({ dia: dayName[dt2sexta.getDay()], data: fmtShort(dt2sexta), irmao: opsEnsaio[pEnsaio % Math.max(1,opsEnsaio.length)] || '—' });
    pEnsaio++;
  }

  // CULTO DE JOVENS: 2º sábado (6)
  const dt2sab = nthWeekday(y, mi, 6, 2);
  const cultoJovRows = [];
  if(dt2sab){
    cultoJovRows.push({ dia: dayName[dt2sab.getDay()], data: fmtShort(dt2sab), irmao: opsCultoJov[pCultoJov % Math.max(1,opsCultoJov.length)] || '—' });
    pCultoJov++;
  }

  // salvar ponteiros
  setPtr('culto', pCulto % Math.max(1, opsCulto.length));
  setPtr('reuniao', pReuniao % Math.max(1, opsReuniao.length));
  setPtr('ensaio', pEnsaio % Math.max(1, opsEnsaio.length));
  setPtr('cultoJovem', pCultoJov % Math.max(1, opsCultoJov.length));

  // montar HTML (cores iguais à imagem)
  let out = '';
  out += sectionHTML('CULTOS:', '#e6e6e6', cultoRows);
  out += sectionHTML('REUNIÃO DE JOVENS:', 'var(--blue)', reuniaoRows);
  out += sectionHTML('ENSAIO:', 'var(--orange)', ensaioRows);
  out += sectionHTML('CULTO DE JOVENS:', 'var(--red)', cultoJovRows);

  document.getElementById('resultArea').innerHTML = out;
}

/* ---------- salvar operadores ---------- */
function saveOperators(){
  setSaved('ops_culto', document.getElementById('opsCulto').value.trim());
  setSaved('ops_reuniao', document.getElementById('opsReuniao').value.trim());
  setSaved('ops_ensaio', document.getElementById('opsEnsaio').value.trim());
  setSaved('ops_culto_jovem', document.getElementById('opsCultoJovem').value.trim());
  alert('Operadores salvos no navegador!');
}

/* ---------- inicialização ---------- */
(function init(){
  // carregar oper. salvos (ou padrão)
  document.getElementById('opsCulto').value = getSaved('ops_culto','ABIMAEL\nDANIEL\nFABIO\nJONATAS');
  document.getElementById('opsReuniao').value = getSaved('ops_reuniao','ABIMAEL\nDANIEL\nFABIO\nJONATAS');
  document.getElementById('opsEnsaio').value = getSaved('ops_ensaio','ABIMAEL\nDANIEL\nFABIO\nJONATAS');
  document.getElementById('opsCultoJovem').value = getSaved('ops_culto_jovem','ABIMAEL\nDANIEL\nFABIO\nJONATAS');

  // default mês atual
  const now = new Date();
  const curMonth = now.getFullYear() + '-' + String(now.getMonth()+1).padStart(2,'0');
  document.getElementById('monthPick').value = curMonth;
  document.getElementById('previewMes').textContent = monthShort[now.getMonth()].toUpperCase() + ' - ' + now.getFullYear();

  document.getElementById('btnGenerate').addEventListener('click', gerarRodizio);
  document.getElementById('btnSaveOps').addEventListener('click', saveOperators);
  document.getElementById('btnResetPtrs').addEventListener('click', resetPtrs);

  // gerar imediato o mês atual
  gerarRodizio();
})();
</script>
</body>
</html>
